---
title: Configurar uma criação de fatura pro forma automatizada
description: Este tópico fornece informações sobre a configuração da criação automática de faturas pro forma.
author: rumant
manager: Annbe
ms.date: 10/13/2020
ms.topic: article
ms.service: dynamics-365-customerservice
ms.reviewer: kfend
ms.author: rumant
ms.openlocfilehash: e146dd510b3795d52d164fc6acf8e5400ba11310
ms.sourcegitcommit: 11a61db54119503e82faec5f99c4273e8d1247e5
ms.translationtype: HT
ms.contentlocale: pt-BR
ms.lasthandoff: 10/16/2020
ms.locfileid: "4071337"
---
# <a name="configure-automated-proforma-invoice-creation"></a><span data-ttu-id="b86ac-103">Configurar uma criação de fatura pro forma automatizada</span><span class="sxs-lookup"><span data-stu-id="b86ac-103">Configure automated proforma invoice creation</span></span>

<span data-ttu-id="b86ac-104">_**Aplica-se a:** Implantação leve - gerenciar faturamento pró-forma_</span><span class="sxs-lookup"><span data-stu-id="b86ac-104">_**Applies To:** Lite deployment - deal to proforma invoicing_</span></span>

<span data-ttu-id="b86ac-105">Você pode configurar a criação automática de faturas no Dynamics 365 Project Operations.</span><span class="sxs-lookup"><span data-stu-id="b86ac-105">You can configure automatic invoice creation in Dynamics 365 Project Operations.</span></span> <span data-ttu-id="b86ac-106">O sistema cria um rascunho de fatura pro forma com base na agenda da fatura para cada contrato de projeto e linha de contrato.</span><span class="sxs-lookup"><span data-stu-id="b86ac-106">The system creates a draft proforma invoice based on the invoice schedule for each project contract and contract line.</span></span> <span data-ttu-id="b86ac-107">As programações de faturas são configuradas no nível da linha do contrato.</span><span class="sxs-lookup"><span data-stu-id="b86ac-107">Invoice schedules are configured at the contract line level.</span></span> <span data-ttu-id="b86ac-108">Cada linha em um contrato pode ter uma agenda de fatura distinta ou a mesma agenda de fatura pode ser incluída em cada linha do contrato.</span><span class="sxs-lookup"><span data-stu-id="b86ac-108">Each line on a contract can have a distinct invoice schedule, or the same invoice schedule can be included on every line of the contract.</span></span>

<span data-ttu-id="b86ac-109">Quando você cria uma fatura, o sistema sempre cria pelo menos uma fatura por contrato de projeto.</span><span class="sxs-lookup"><span data-stu-id="b86ac-109">When you create an invoice, the system always creates at least one invoice per project contract.</span></span> <span data-ttu-id="b86ac-110">Em alguns casos, pode haver várias faturas criadas.</span><span class="sxs-lookup"><span data-stu-id="b86ac-110">In some cases, there may be multiple invoices created.</span></span>

<span data-ttu-id="b86ac-111">Por exemplo, se o contrato tiver vários clientes, o mesmo número de faturas será criado como o número de clientes que têm transações faturáveis para faturar nesse contrato de projeto.</span><span class="sxs-lookup"><span data-stu-id="b86ac-111">For example, if the contract has multiple customers, the same number of invoices will be created as the number of customers that have billable transactions to invoice on that project contract.</span></span>

## <a name="understand-how-transactions-are-included-on-an-invoice"></a><span data-ttu-id="b86ac-112">Entenda como as transações são incluídas em uma fatura</span><span class="sxs-lookup"><span data-stu-id="b86ac-112">Understand how transactions are included on an invoice</span></span> 

<span data-ttu-id="b86ac-113">Às vezes, cada linha de contrato com base em projeto especifica uma agenda de fatura separada.</span><span class="sxs-lookup"><span data-stu-id="b86ac-113">Sometimes, each project-based contract line specifies a separate invoice schedule.</span></span> <span data-ttu-id="b86ac-114">Por exemplo, os serviços de implementação para o contrato Adatum têm as seguintes linhas de contrato:</span><span class="sxs-lookup"><span data-stu-id="b86ac-114">For example, implementation services for the Adatum contract have the following contract lines:</span></span>

- <span data-ttu-id="b86ac-115">Trabalho de protótipo que tem um preço fixo com dois marcos criados manualmente.</span><span class="sxs-lookup"><span data-stu-id="b86ac-115">Prototype work that is a fixed price with two manually created milestones.</span></span>
- <span data-ttu-id="b86ac-116">Trabalho de implementação que inclui Tempo e será cobrado a cada duas semanas às segundas-feiras.</span><span class="sxs-lookup"><span data-stu-id="b86ac-116">Implementation work that includes Time and will be billed bi-weekly on Mondays.</span></span>
- <span data-ttu-id="b86ac-117">Despesas incorridas que precisam ser cobradas mensalmente na primeira segunda-feira de cada mês.</span><span class="sxs-lookup"><span data-stu-id="b86ac-117">Expenses incurred that need to be billed monthly on the first Monday of each month.</span></span>

<span data-ttu-id="b86ac-118">As programações de faturas definidas em cada um desses dois itens de linha se parecem com a seguinte tabela:</span><span class="sxs-lookup"><span data-stu-id="b86ac-118">Invoice schedules defined on each of these two line items look like the following table:</span></span>

| <span data-ttu-id="b86ac-119">Linha de contrato</span><span class="sxs-lookup"><span data-stu-id="b86ac-119">Contract line</span></span> | <span data-ttu-id="b86ac-120">Data de criação da fatura</span><span class="sxs-lookup"><span data-stu-id="b86ac-120">Invoice run date</span></span> | <span data-ttu-id="b86ac-121">Data de corte da transação</span><span class="sxs-lookup"><span data-stu-id="b86ac-121">Transaction cut-off date</span></span> | <span data-ttu-id="b86ac-122">Data da etapa</span><span class="sxs-lookup"><span data-stu-id="b86ac-122">Milestone date</span></span> | <span data-ttu-id="b86ac-123">Valor do marco</span><span class="sxs-lookup"><span data-stu-id="b86ac-123">Milestone amount</span></span> |
| --- | --- | --- | --- | --- |
| <span data-ttu-id="b86ac-124">Trabalho de protótipo</span><span class="sxs-lookup"><span data-stu-id="b86ac-124">Prototype work</span></span> | <span data-ttu-id="b86ac-125">Segunda-feira, 5 de outubro</span><span class="sxs-lookup"><span data-stu-id="b86ac-125">October 5, Monday</span></span> | - | <span data-ttu-id="b86ac-126">Segunda-feira, 5 de outubro</span><span class="sxs-lookup"><span data-stu-id="b86ac-126">October 5, Monday</span></span> | <span data-ttu-id="b86ac-127">5000 USD</span><span class="sxs-lookup"><span data-stu-id="b86ac-127">5000 USD</span></span> |
| - | <span data-ttu-id="b86ac-128">Terça-feira, 3 de novembro</span><span class="sxs-lookup"><span data-stu-id="b86ac-128">November 3, Tuesday</span></span> | - | <span data-ttu-id="b86ac-129">Terça-feira, 3 de novembro</span><span class="sxs-lookup"><span data-stu-id="b86ac-129">November 3, Tuesday</span></span> | <span data-ttu-id="b86ac-130">12,000 USD</span><span class="sxs-lookup"><span data-stu-id="b86ac-130">12,000 USD</span></span> |
| <span data-ttu-id="b86ac-131">Trabalho de implementação</span><span class="sxs-lookup"><span data-stu-id="b86ac-131">Implementation work</span></span> | <span data-ttu-id="b86ac-132">Segunda-feira, 5 de outubro</span><span class="sxs-lookup"><span data-stu-id="b86ac-132">October 5, Monday</span></span> | <span data-ttu-id="b86ac-133">Domingo, 4 de outubro</span><span class="sxs-lookup"><span data-stu-id="b86ac-133">October 4, Sunday</span></span> | - | - |
| - | <span data-ttu-id="b86ac-134">Segunda-feira, 19 de outubro</span><span class="sxs-lookup"><span data-stu-id="b86ac-134">October 19, Monday</span></span> | <span data-ttu-id="b86ac-135">Domingo, 18 de outubro</span><span class="sxs-lookup"><span data-stu-id="b86ac-135">October 18, Sunday</span></span> | - | - |
| - | <span data-ttu-id="b86ac-136">Segunda-feira, 2 de novembro</span><span class="sxs-lookup"><span data-stu-id="b86ac-136">November 2, Monday</span></span> | <span data-ttu-id="b86ac-137">Domingo, 1º de novembro</span><span class="sxs-lookup"><span data-stu-id="b86ac-137">November 1, Sunday</span></span> | - | - |
| - | <span data-ttu-id="b86ac-138">Segunda-feira, 16 de novembro</span><span class="sxs-lookup"><span data-stu-id="b86ac-138">November 16, Monday</span></span> | <span data-ttu-id="b86ac-139">Domingo, 15 de novembro</span><span class="sxs-lookup"><span data-stu-id="b86ac-139">November 15, Sunday</span></span> | - | - |
| <span data-ttu-id="b86ac-140">Despesas incorridas</span><span class="sxs-lookup"><span data-stu-id="b86ac-140">Expenses incurred</span></span> | <span data-ttu-id="b86ac-141">Segunda-feira, 5 de outubro</span><span class="sxs-lookup"><span data-stu-id="b86ac-141">October 5, Monday</span></span> | <span data-ttu-id="b86ac-142">Domingo, 4 de outubro</span><span class="sxs-lookup"><span data-stu-id="b86ac-142">October 4, Sunday</span></span> | - | - |
| - | <span data-ttu-id="b86ac-143">Segunda-feira, 2 de novembro</span><span class="sxs-lookup"><span data-stu-id="b86ac-143">November 2, Monday</span></span> | <span data-ttu-id="b86ac-144">Domingo, 1º de novembro</span><span class="sxs-lookup"><span data-stu-id="b86ac-144">November 1, Sunday</span></span> | - | - |

<span data-ttu-id="b86ac-145">Neste exemplo, quando o faturamento automático é executado em:</span><span class="sxs-lookup"><span data-stu-id="b86ac-145">In this example when the automatic invoicing runs on:</span></span>

- <span data-ttu-id="b86ac-146">**4 de outubro ou qualquer data antes** : nenhuma fatura é gerada para esse contrato porque a tabela **Agenda de Fatura** para cada uma dessas linhas de contrato não indica Domingo, 4 de outubro como uma data de execução da fatura.</span><span class="sxs-lookup"><span data-stu-id="b86ac-146">**October 4 or any date before** : No invoice is generated for this contract because the **Invoice Schedule** table for each of these contract lines doesn't call out October 4, Sunday as an invoice run date.</span></span>
- <span data-ttu-id="b86ac-147">**Segunda-feira, 5 de outubro** : uma fatura é gerada para:</span><span class="sxs-lookup"><span data-stu-id="b86ac-147">**October 5 Monday** : One invoice is generated for:</span></span>

    - <span data-ttu-id="b86ac-148">O trabalho de protótipo que inclui o marco, se ele estiver marcado como **Pronto para Faturar**.</span><span class="sxs-lookup"><span data-stu-id="b86ac-148">Prototype work that includes the milestone, if it is marked as **Ready to Invoice**.</span></span>
    - <span data-ttu-id="b86ac-149">Trabalho de implementação que inclui todas as transações de Tempo criadas antes da data limite da transação de Domingo, 4 de outubro, que está marcada como **Pronta para Faturar**.</span><span class="sxs-lookup"><span data-stu-id="b86ac-149">Implementation work that includes all Time transactions created before the transaction cut-off date of October 4, Sunday, that is marked as **Ready to Invoice**.</span></span>
    - <span data-ttu-id="b86ac-150">Despesa incorrida que inclui todas as Transações de despesa criadas antes da data limite da transação de Domingo, 4 de outubro, que está marcada como **Pronta para Faturar**.</span><span class="sxs-lookup"><span data-stu-id="b86ac-150">Expense incurred that includes all Expense transactions created before the transaction cut-off date of October 4, Sunday, that is marked as **Ready to Invoice**.</span></span>
  
- <span data-ttu-id="b86ac-151">**Em 6 de outubro ou em qualquer data antes de 19 de outubro** : nenhuma fatura é gerada para esse contrato porque a tabela **Agenda de Fatura** para cada uma dessas linhas de contrato não indica 6 de outubro ou qualquer data antes de 19 de outubro como uma data de execução da fatura.</span><span class="sxs-lookup"><span data-stu-id="b86ac-151">**On October 6 or any date before October 19** : No invoice is generated for this contract since the **Invoice Schedule** table for each of these contract lines does not call out October 6 or any date before October 19 as an invoice run date.</span></span>
- <span data-ttu-id="b86ac-152">**Segunda, 19 de outubro** : uma fatura é gerada para trabalho de implementação que inclui todas as transações de Tempo criadas antes da data limite da transação de Domingo, 18 de outubro, que está marcada como **Pronta para Faturar**.</span><span class="sxs-lookup"><span data-stu-id="b86ac-152">**October 19, Monday** : One invoice is generated for implementation work that includes all Time transactions created before the transaction cut-off date of October 18, Sunday, that is marked as **Ready to Invoice**.</span></span>
- <span data-ttu-id="b86ac-153">**Segunda-feira, 2 de novembro** : uma fatura é gerada para:</span><span class="sxs-lookup"><span data-stu-id="b86ac-153">**November 2 Monday** : One invoice is generated for:</span></span>

    - <span data-ttu-id="b86ac-154">Trabalho de implementação que inclui todas as transações de Tempo criadas antes da data limite da transação de Domingo, 1º de novembro, que está marcada como **Pronta para Faturar**.</span><span class="sxs-lookup"><span data-stu-id="b86ac-154">Implementation work that includes all Time transactions created before the transaction cut-off date of November 1, Sunday, that is marked as **Ready to Invoice**.</span></span>
    - <span data-ttu-id="b86ac-155">Despesa incorrida que inclui todas as Transações de despesa criadas antes da data limite da transação de Domingo, 1º de novembro, que está marcada como **Pronta para Faturar**.</span><span class="sxs-lookup"><span data-stu-id="b86ac-155">Expense incurred that includes all Expense transactions created before the transaction cut-off date of November 1, Sunday, that is marked as **Ready to Invoice**.</span></span>

- <span data-ttu-id="b86ac-156">**Terça-feira, 3 de novembro** : uma fatura é gerada para o trabalho de protótipo que inclui o marco para 12000 USD, se estiver marcado como **Pronto para faturar**.</span><span class="sxs-lookup"><span data-stu-id="b86ac-156">**November 3, Tuesday** : One invoice is generated for prototype work that includes the milestone for 12000 USD, if it is marked as **Ready to Invoice**.</span></span>

## <a name="configure-automatic-invoicing"></a><span data-ttu-id="b86ac-157">Configurar o faturamento automático</span><span class="sxs-lookup"><span data-stu-id="b86ac-157">Configure automatic invoicing</span></span>

<span data-ttu-id="b86ac-158">Conclua as etapas a seguir para configurar a execução de uma fatura automatizada.</span><span class="sxs-lookup"><span data-stu-id="b86ac-158">Complete the following steps to configure an automated invoice run.</span></span>

1. <span data-ttu-id="b86ac-159">Em **Operações de Projeto** , vá para **Configurações** > **Configuração de Fatura Recorrente**.</span><span class="sxs-lookup"><span data-stu-id="b86ac-159">In **Project Operations** , go to **Settings** > **Recurring Invoice Setup**.</span></span>
2. <span data-ttu-id="b86ac-160">Crie um trabalho em lote e denomine-o **Criar Faturas do Project Operations**.</span><span class="sxs-lookup"><span data-stu-id="b86ac-160">Create a batch job, and name it **rPoject Operations Create Invoices**.</span></span> <span data-ttu-id="b86ac-161">O nome do trabalho em lote deve incluir as palavras "criar faturas".</span><span class="sxs-lookup"><span data-stu-id="b86ac-161">The name of the batch job must include the words, "create invoices".</span></span>
3. <span data-ttu-id="b86ac-162">No campo **Tipo de Trabalho** , selecione **Nenhum**.</span><span class="sxs-lookup"><span data-stu-id="b86ac-162">In the **Job Type** field, select **None**.</span></span> <span data-ttu-id="b86ac-163">Por padrão, os campos **Frequência Diária** e **Está Ativo** são definidos como **Sim**.</span><span class="sxs-lookup"><span data-stu-id="b86ac-163">By default, the **Frequency Daily** and **Is Active** fields are set to **Yes**.</span></span>
4. <span data-ttu-id="b86ac-164">Selecione **Executar Fluxo de Trabalho**.</span><span class="sxs-lookup"><span data-stu-id="b86ac-164">Select **Run Workflow**.</span></span> <span data-ttu-id="b86ac-165">Na caixa de diálogo **Pesquisar Registro** , você verá três fluxos de trabalho:</span><span class="sxs-lookup"><span data-stu-id="b86ac-165">In the **Look Up Record** dialog box, you will see three workflows:</span></span>

- <span data-ttu-id="b86ac-166">ProcessRunCaller</span><span class="sxs-lookup"><span data-stu-id="b86ac-166">ProcessRunCaller</span></span>
- <span data-ttu-id="b86ac-167">ProcessRunner</span><span class="sxs-lookup"><span data-stu-id="b86ac-167">ProcessRunner</span></span>
- <span data-ttu-id="b86ac-168">UpdateRoleUtilization</span><span class="sxs-lookup"><span data-stu-id="b86ac-168">UpdateRoleUtilization</span></span>

5. <span data-ttu-id="b86ac-169">Selecione **ProcessRunCaller** e selecione **Adicionar**.</span><span class="sxs-lookup"><span data-stu-id="b86ac-169">Select **ProcessRunCaller** , and then select **Add**.</span></span>
6. <span data-ttu-id="b86ac-170">Na próxima caixa de diálogo, selecione **OK**.</span><span class="sxs-lookup"><span data-stu-id="b86ac-170">In the next dialog box, select **OK**.</span></span> <span data-ttu-id="b86ac-171">Um fluxo de trabalho **Suspender** é seguido por um fluxo de trabalho **Processar**.</span><span class="sxs-lookup"><span data-stu-id="b86ac-171">A **Sleep** workflow is followed by a **Process** workflow.</span></span> 

> [!NOTE]
> <span data-ttu-id="b86ac-172">Também é possível selecionar **ProcessRunner** na etapa 5.</span><span class="sxs-lookup"><span data-stu-id="b86ac-172">You can also select **ProcessRunner** in step 5.</span></span> <span data-ttu-id="b86ac-173">Em seguida, quando você selecionar **OK** , um fluxo de trabalho **Processar** é seguido por um fluxo de trabalho **Suspender**.</span><span class="sxs-lookup"><span data-stu-id="b86ac-173">Then, when you select **OK** , a **Process** workflow is followed by a **Sleep** workflow.</span></span>

<span data-ttu-id="b86ac-174">Os fluxos de trabalho **ProcessRunCaller** e **ProcessRunner** criam faturas.</span><span class="sxs-lookup"><span data-stu-id="b86ac-174">The **ProcessRunCaller** and **ProcessRunner** workflows create invoices.</span></span> <span data-ttu-id="b86ac-175">**ProcessRunCaller** chama **ProcessRunner**.</span><span class="sxs-lookup"><span data-stu-id="b86ac-175">**ProcessRunCaller** calls **ProcessRunner**.</span></span> <span data-ttu-id="b86ac-176">**ProcessRunner** é o fluxo de trabalho que de fato cria as faturas.</span><span class="sxs-lookup"><span data-stu-id="b86ac-176">**ProcessRunner** is the workflow that actually creates the invoices.</span></span> <span data-ttu-id="b86ac-177">O fluxo de trabalho passa por todas as linhas de contrato para as quais as faturas devem ser criadas e cria faturas para essas linhas.</span><span class="sxs-lookup"><span data-stu-id="b86ac-177">The workflow goes through all the contract lines that invoices must be created for, and creates invoices for those lines.</span></span> <span data-ttu-id="b86ac-178">A fim de determinar as linhas de contrato para as quais as faturas devem ser criadas, o trabalho examina as datas de execução de fatura das linhas de contrato.</span><span class="sxs-lookup"><span data-stu-id="b86ac-178">To determine the contract lines that invoices must be created for, the job looks at invoice run dates for the contract lines.</span></span> <span data-ttu-id="b86ac-179">Se as linhas de contrato que pertencem a um contrato tiverem a mesma data de execução de fatura, as transações serão combinadas em uma fatura que tenha duas linhas de fatura.</span><span class="sxs-lookup"><span data-stu-id="b86ac-179">If contract lines that belong to one contract have the same invoice run date, the transactions are combined into one invoice that has two invoice lines.</span></span> <span data-ttu-id="b86ac-180">Se não houver transações para as quais criar faturas, o trabalho pulará a criação de uma fatura.</span><span class="sxs-lookup"><span data-stu-id="b86ac-180">If there are no transactions to create invoices for, the job skips creating an invoice.</span></span>

<span data-ttu-id="b86ac-181">Quando **ProcessRunner** termina de ser executado, ele chama **ProcessRunCaller** , fornece a hora de término e é fechado.</span><span class="sxs-lookup"><span data-stu-id="b86ac-181">After **ProcessRunner** has finished running, it calls **ProcessRunCaller** , provides the end time, and is closed.</span></span> <span data-ttu-id="b86ac-182">**ProcessRunCaller** então inicia um timer que é executado por 24 horas a partir da hora de término especificada.</span><span class="sxs-lookup"><span data-stu-id="b86ac-182">**ProcessRunCaller** then starts a timer that runs for 24-hours from the specified end time.</span></span> <span data-ttu-id="b86ac-183">Ao fim do timer, **ProcessRunCaller** é fechado.</span><span class="sxs-lookup"><span data-stu-id="b86ac-183">At the end of the timer, **ProcessRunCaller** is closed.</span></span>

<span data-ttu-id="b86ac-184">O trabalho do processo em lote para criação de faturas é um trabalho recorrente.</span><span class="sxs-lookup"><span data-stu-id="b86ac-184">The batch process job for creating invoices is a recurrent job.</span></span> <span data-ttu-id="b86ac-185">Se esse processo em lote for executado muitas vezes, várias instâncias do trabalho serão criadas e causarão erros.</span><span class="sxs-lookup"><span data-stu-id="b86ac-185">If this batch process is run many times, multiple instances of the job are created and causes errors.</span></span> <span data-ttu-id="b86ac-186">Portanto, você deve iniciar o processo em lote apenas uma vez e então reiniciar somente se a execução for interrompida.</span><span class="sxs-lookup"><span data-stu-id="b86ac-186">Therefore, you should start the batch process only one time, and then restart only if it stops running.</span></span>

> [!NOTE]
> <span data-ttu-id="b86ac-187">O faturamento em lote no Project Operations só é executado para linhas de contrato de projeto configuradas por agendas de faturas.</span><span class="sxs-lookup"><span data-stu-id="b86ac-187">Batch invoicing in Project Operations only runs for project contract lines that are configured by invoice schedules.</span></span> <span data-ttu-id="b86ac-188">Uma linha de contrato com um método de cobrança de preço fixo deve ter marcos configurados.</span><span class="sxs-lookup"><span data-stu-id="b86ac-188">A contract line with a fixed price billing method must have milestones configured.</span></span> <span data-ttu-id="b86ac-189">Uma linha de contrato do projeto com um método de cobrança de horas e de material precisará de uma configuração de agenda de faturas baseada em data.</span><span class="sxs-lookup"><span data-stu-id="b86ac-189">A project contract line with a time and material billing method will need a date-based invoice schedule set up.</span></span>
